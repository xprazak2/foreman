<% title(_('Smart Proxy: %s') % @smart_proxy.to_label) %>
<%= smart_proxy_title_actions(@smart_proxy, authorizer) %>
<% service_features = services_tab_features(@smart_proxy) %>
<div class="row proxy-show" data-url="<%= ping_smart_proxy_path(@smart_proxy) %>">
  <ul id="proxy-tab" class="nav nav-tabs">
    <li class="active"><a href="#properties" data-toggle="tab"><%= _('Overview') %></a></li>
    <% if service_features.any? %>
      <li><a href="#services" data-toggle="tab"><%= _('Services') %></a></li>
    <% end %>
    <% if @smart_proxy.features.include? "puppet" %>
      <li><a href="#puppet" data-toggle="tab">Puppet</a></li>
    <% end %>
  </ul>
  <div id="proxy-tab-content" class="proxy-content tab-content">
    <div class="tab-pane active in" id="properties">
      <div class="col-md-6">
        <div class="row">
          <h3><%= _('Details') %></h3>
        </div>
        <div class="row">
          <div class="col-md-4">
            <%= _('Communication status') %>
          </div>
          <div class="col-md-8">
            <span class="proxy-show-status">
              <%= spinner %>
            </span>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <%= _('URL') %>
          </div>
          <div class="col-md-8">
            <%= @smart_proxy.url %>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <%= _('Version') %>
          </div>
          <div class="col-md-8">
            <span class="proxy-version" data-url="<%= ping_smart_proxy_path(@smart_proxy) %>">
              <%= spinner %>
            </span>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <%= _('Features') %>
          </div>
          <div class="col-md-8">
            <%= @smart_proxy.features.to_sentence %> <%= refresh_proxy_icon(@smart_proxy, authorizer) %>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <!--place holder for Capsule sync-->
      </div>
    </div>
    <% if service_features.any? %>
      <div class="tab-pane" id="services">
        <div class="col-md-6">
          <% service_features.each do |feature| %>
            <% feature_erb = "smart_proxies/plugins/#{feature}" %>
            <% if lookup_context.template_exists?(feature_erb, [], true) %>
              <%= render :partial => feature_erb, :locals => {:feature => feature} %>
            <% else %>
              <%= render :partial => "smart_proxies/plugins/no_template", :locals => {:feature => feature} %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @smart_proxy.features.include? "puppet" %>
      <div class="tab-pane" id="puppet">
        <div class="col-md-8">

          <div class="row">
            <h3><%= _('Puppet Details') %></h3>
          </div>

          <div class="row">
            <div class="col-md-4">
              <%= _('Puppet Status') %>
            </div>
            <div class="col-md-8">
              <span class="proxy-version" data-url="<%= puppet_status_smart_proxy_path(@smart_proxy) %>">
                <%#= spinner %>
              </span>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <%= _('Puppet CA') %>
            </div>
            <div class="col-md-8">
              <span class="proxy-version" data-url="">
                <%#= spinner %>
              </span>
            </div>
          </div>

          <div class="row">
            <h3><%= _('Puppet Activity') %></h3>
          </div>

          <% if last_report = @smart_proxy.last_puppet_report %>
            <div class="row">
              <div class="col-md-4">
                <%= _('Last report') %>
              </div>
              <div class="col-md-8">
                <span class="proxy-version" data-url="">
                  <a href="<%= config_report_path(last_report.id) %>"><%= last_report.reported_at %></a>
                  for host <a href="<%= host_path(last_report.host_id) %>"><%= last_report.host.name %></a>
                </span>
              </div>
            </div>
          <% else %>
            <div class="row">
              <div class="alert alert-info">
                <%= _("No Puppet activity found") %>
              </div>
            </div>
          <% end %>

        </div>
      </div>
    <% end %>

  </div>
</div>
